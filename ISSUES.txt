-------------------------------------------------------------------------------
src/callf
-------------------------------------------------------------------------------

* Fix the case where the
  `callf /tee-stdin 0.log /pipe-stdin-to-child-stdin "" "cmd.exe /k"`
  expression has broken/altered autocompletion feature in the `cmd.exe` process
  and the `cmd.exe` treats all the tab characters as is.

  The issue is attached to the stdin handle type inside the `cmd.exe` process.
  If the stdin handle has not a character device type
  (GetFileType(GetStdHandle(STD_INPUT_HANDLE)) != FILE_TYPE_CHAR), then the
  autocompletion feature is turned off and all characters including a tab
  character processes as is. Otherwise the tab button press triggers
  the autocompletion feature.

  The stdin handle changes its type from the `FILE_TYPE_CHAR`, for example, if
  the process input is redirected.

  The fix can be made portably between different Windows versions, for example,
  through the code injection into a child process and interception of the
  `ReadConsole`/`WriteConsole` calls.

* Fix `start "" /WAIT callfg.exe /attach-parent-console "" "unexisted.exe"`
  invalid print in non 65001 code page.

* Fix `callf.exe /detach-console "" "unexisted.exe"` crash.

* Fix `callf.exe` long paths open including relative to the current directory
  paths.

* Fix `callf.exe /shell-exec-unelevate-from-explorer /D . "callf.exe" "/shell-exec runas \"${COMSPEC}\" \"/k\""`
  current directory propagation.

* The `/r* ...` options does not execute for variable arguments

* Fix leak behind `/load-parent-proc-init-env-vars` before this-process exit
  (call UnMapViewOfFile and CloseHandle)

* Fix `callf /D "<long-path>` ...` by using `SetCurrentDirectory` with `\\?\`
  prefix.

  Add `/CD ...` option to change current directory before a child process
  creation.

  Update `KNOWN ISSUES` section.

* Fix `callf "" "callf /create-console /invalid-flag \"\" \"cmd.exe /c echo 123\""`
  error message around `/invalid-flag` which is not always reprint in the
  first callf process console window.

* callf crash on too long wait for UAC promotion with error message:
  `server connection timeout of inbound server named pipe end to (null): pipe="(null)" timeout=0 ms`

* Fix nested quotes escape skip in case of `{*}` variable substitution:

  >
  callf.exe /pause-on-exit /no-esc /elevate{ /no-window }{ /attach-parent-console } "${SystemRoot}\System32\runas.exe" "/user:user {*}" "\"${SystemRoot}\System32\explorer.exe\" \"...\.\""

  Result:

  >
  callf.exe /pause-on-exit /no-subst-vars /no-esc /attach-parent-console "C:\WINDOWS\System32\runas.exe" "/user:user \"\\"C:\WINDOWS\System32\explorer.exe\\" \\"...\\.\\"\""

  Must be:

  >
  callf.exe /pause-on-exit /no-subst-vars /no-esc /attach-parent-console "C:\WINDOWS\System32\runas.exe" "/user:user \"\\\"C:\WINDOWS\System32\explorer.exe\\\" \\\"...\\.\\\"\""

* Unknown unicode characters prints as `?` in case of tee redirection options:

  `/tee-stdout <stdout-file>`

  Replace by unicode print function variant.

* Hangs (in the `contools` `exec_callf_prefix.bat` script) if a current drive 
  is in a sleeping state.

* Fix default environment expansion in an elevated command line (here is in case of `/E0` usage):

  >
  callfg.exe /elevate /E0 /no-subst-vars /no-esc "" "\"${SystemRoot}\System32\cmd.exe\" /k"

  This command line is malformed, but does execute, because `${SystemRoot}` here does expand, when must not.

  Seems `/no-expand-env` must be passed on to elevated command line by default if the second level `/elevate` options are not used.

  But is much better here is always use `/no-expand-env` flag in an elevated command line when `/allow-expand-env` is not used:

  >
  callfg.exe /elevate{ }{ /allow-expand-env } /no-subst-vars /no-esc "" "\"${SystemRoot}\System32\cmd.exe\" /k"

  In that case `/no-expand-env` flag must be always regular and excluded from `/elevate{ ... }{ ... }` options.

  Examples of the first solution variant:

    Second level is used:

      `/elevate{ }{ /no-expand-env }` or `/elevate{ }{ /E1 }`

    Second level is not used:

      `/elevate` or `/elevate{ ... }`

  Note, currently user must use this to workaround:

  >
  callfg.exe /elevate{ }{ /no-expand-env } /E0 /no-subst-vars /no-esc "" "\"${SystemRoot}\System32\cmd.exe\" /k"

  Which is definitely longer and is not error prone.

  With the second solution variant it would be shorter and won't be executed as would be malformed because a user mistake in `/E` option:

  >
  callfg.exe /elevate /E0 ... "" "\"${SystemRoot}\System32\cmd.exe\" /k"

* Fix ShellExecute error on a relative path to `callf.exe` in Windows 7:

  >
  callf.exe /elevate "" "cmd.exe /k echo 123"

* Fix server inbound pipe creation in Windows XP:

  >
  "%~dp0callf.exe" ^
    /promote-parent{ /pause-on-exit } ^
    /elevate{ /no-window /create-inbound-server-pipe-to-stdout test_stdout_{pid} /create-inbound-server-pipe-to-stderr test_stderr_{pid} ^
    }{ /attach-parent-console /reopen-stdout-as-client-pipe test_stdout_{ppid} /reopen-stderr-as-client-pipe test_stderr_{ppid} } ^
    "" "cmd.exe /k echo 123"

  error: could not create inbound server named pipe end to stdout: win_error=0x00000057 (87)

* Fix line returns break in Windows 7:

  Prints `AAABBBCCCDDD` as a single line without line returns if press the
  enter key on each input.

  >
  @echo off

  setlocal

  if %IMPL_MODE%0 NEQ 0 goto IMPL

  "%~dp0callf.exe" ^
    /promote-parent{ /pause-on-exit } ^
    /elevate{ /no-window /create-inbound-server-pipe-to-stdout test_stdout_{pid} /create-inbound-server-pipe-to-stderr test_stderr_{pid} ^
    }{ /attach-parent-console /reopen-stdout-as-client-pipe test_stdout_{ppid} /reopen-stderr-as-client-pipe test_stderr_{ppid} } ^
    /v IMPL_MODE 1 "" "cmd.exe /c @%0 %*"
  exit /b

  :IMPL
  set /P X=AAA
  set /P X=BBB
  set /P X=CCC
  set /P X=DDD

-------------------------------------------------------------------------------
tests/manual/contools/callf
-------------------------------------------------------------------------------

* Fix slow print:

  - 00-test--01-cui--02-existing_console--01-print_help.bat
  - 00-test--02-gui--02-existing_console--01-print_help.bat

-------------------------------------------------------------------------------
src/wshbazaar/wshdynacall
-------------------------------------------------------------------------------

* component registration error under Windows XP 32-bit SP3
